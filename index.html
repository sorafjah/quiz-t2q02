<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像付き2択クイズアプリ (複数問題対応版)</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter) を読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Interフォントを全体に適用 */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* タップ時のハイライトを無効化 */
        }
        /* ボタンや入力欄のフォーカス時のアウトラインを調整 */
        :focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        /* ローディングスピナー */
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <!-- ===== ホーム画面 ===== -->
        <div id="home-screen" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg space-y-6">
            <h1 class="text-3xl font-bold text-center text-gray-900">テキストから画像付き2択クイズ</h1>
            <p class="text-center text-gray-500">クイズを作成するか、クイズ名を入力して開始・編集してください。</p>
            
            <div>
                <button id="create-new-quiz-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg">
                    新しいクイズを作成する
                </button>
            </div>
            
            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-300"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-white text-gray-500">または</span>
                </div>
            </div>

            <div class="space-y-4">
                <label for="quiz-name-input-home" class="block text-sm font-medium text-gray-700">既存のクイズを読み込む</label>
                <input type="text" id="quiz-name-input-home" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="クイズ名を入力">
                <div class="flex gap-4">
                    <button id="edit-quiz-btn" class="w-1/2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg">
                        クイズを編集
                    </button>
                    <button id="start-quiz-btn" class="w-1/2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg">
                        クイズを開始
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== クイズ編集画面 ===== -->
        <div id="edit-screen" class="hidden bg-white p-6 sm:p-8 rounded-xl shadow-lg space-y-6">
            <h2 class="text-2xl font-bold text-gray-900">クイズの作成・編集</h2>
            
            <div class="space-y-2">
                <label for="quiz-name-edit" class="block text-sm font-medium text-gray-700">クイズ名</label>
                <input type="text" id="quiz-name-edit" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="例: 動物クイズ">
            </div>

            <div class="space-y-2">
                 <label for="json-input" class="block text-sm font-medium text-gray-700">
                    JSONデータ
                    <a href="https://chatgpt.com/g/g-68e79a810ad48191b8433cf72d5ea89b-2ze-json" target="_blank" rel="noopener noreferrer" class="ml-2 text-sm text-blue-600 underline hover:text-blue-800">
                        (GPTsでJSONを生成)
                    </a>
                </label>
                <textarea id="json-input" rows="8" class="w-full p-3 border border-gray-300 rounded-lg font-mono text-sm" placeholder="ここにGPTsで生成したJSONを貼り付けます"></textarea>
            </div>
            
            <!-- 画像URL入力欄を動的に生成するコンテナ -->
            <div id="image-inputs-container" class="space-y-6 border-t border-gray-200 pt-6">
                <p class="text-center text-gray-500">JSONを貼り付けると、ここに画像URLの入力欄が表示されます。</p>
            </div>

            <div class="flex gap-4">
                <button id="back-to-home-btn" class="w-1/3 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    戻る
                </button>
                <button id="save-quiz-btn" class="w-2/3 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    この内容で保存
                </button>
            </div>
        </div>

        <!-- ===== クイズ実行画面 ===== -->
        <div id="quiz-screen" class="hidden bg-white p-6 sm:p-8 rounded-xl shadow-lg space-y-4">
            <div class="flex justify-between items-center">
                <h2 id="quiz-title" class="text-xl font-bold text-gray-900">クイズタイトル</h2>
                <p id="quiz-progress" class="text-sm font-medium text-gray-500">1 / 10</p>
            </div>
            
            <div id="question-img-container" class="hidden my-4">
                 <img id="question-img" src="" class="w-full h-auto object-contain rounded-lg aspect-video mx-auto bg-gray-100">
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
                <p id="question-text" class="text-lg font-semibold text-center min-h-[3em] flex items-center justify-center">問題文がここに表示されます。</p>
            </div>

            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 選択肢A -->
                <button id="option-a-btn" data-option="A" class="option-btn flex flex-col items-center justify-center p-2 min-h-[10rem] border-4 border-transparent rounded-xl hover:border-blue-500 focus:border-blue-500 transition-all duration-300 space-y-2">
                    <img id="option-a-img" src="" class="w-full h-auto object-contain rounded-lg aspect-[4/3] hidden bg-gray-100">
                    <p id="option-a-text" class="font-semibold text-center px-2">選択肢A</p>
                </button>
                <!-- 選択肢B -->
                <button id="option-b-btn" data-option="B" class="option-btn flex flex-col items-center justify-center p-2 min-h-[10rem] border-4 border-transparent rounded-xl hover:border-blue-500 focus:border-blue-500 transition-all duration-300 space-y-2">
                    <img id="option-b-img" src="" class="w-full h-auto object-contain rounded-lg aspect-[4/3] hidden bg-gray-100">
                    <p id="option-b-text" class="font-semibold text-center px-2">選択肢B</p>
                </button>
            </div>
            
            <div id="feedback-container" class="hidden p-4 rounded-lg space-y-2">
                <h3 id="feedback-result" class="text-2xl font-bold text-center"></h3>
                <p id="feedback-explanation" class="text-gray-700"></p>
            </div>

            <div class="flex gap-4">
                <button id="quiz-back-to-home-btn" class="w-1/3 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    終了する
                </button>
                <button id="next-question-btn" class="w-2/3 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 hidden">
                    次の問題へ
                </button>
            </div>
        </div>
        
        <!-- ===== ローディング表示 ===== -->
        <div id="loading-indicator" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="loader"></div>
        </div>

        <!-- ===== メッセージボックス ===== -->
        <div id="message-box" class="hidden fixed bottom-5 right-5 bg-red-500 text-white py-3 px-5 rounded-lg shadow-xl animate-pulse">
            <p id="message-text"></p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- DOM要素の取得 ---
        const screens = { home: document.getElementById('home-screen'), edit: document.getElementById('edit-screen'), quiz: document.getElementById('quiz-screen'), };
        const loadingIndicator = document.getElementById('loading-indicator');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const createNewQuizBtn = document.getElementById('create-new-quiz-btn');
        const quizNameInputHome = document.getElementById('quiz-name-input-home');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const editQuizBtn = document.getElementById('edit-quiz-btn'); 
        const quizNameEdit = document.getElementById('quiz-name-edit');
        const jsonInput = document.getElementById('json-input');
        const imageInputsContainer = document.getElementById('image-inputs-container');
        const saveQuizBtn = document.getElementById('save-quiz-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const quizTitle = document.getElementById('quiz-title');
        const quizProgress = document.getElementById('quiz-progress');
        const questionText = document.getElementById('question-text');
        const questionImgContainer = document.getElementById('question-img-container');
        const questionImg = document.getElementById('question-img');
        const optionsContainer = document.getElementById('options-container');
        const optionABtn = document.getElementById('option-a-btn');
        const optionBBtn = document.getElementById('option-b-btn');
        const optionAImg = document.getElementById('option-a-img');
        const optionBImg = document.getElementById('option-b-img');
        const optionAText = document.getElementById('option-a-text');
        const optionBText = document.getElementById('option-b-text');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackResult = document.getElementById('feedback-result');
        const feedbackExplanation = document.getElementById('feedback-explanation');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const quizBackToHomeBtn = document.getElementById('quiz-back-to-home-btn');

        // --- グローバル変数 ---
        let db, auth, userId, currentQuizData = null, currentQuestionIndex = 0, score = 0;
        
        // --- Firebase初期化 ---
        async function initializeFirebase() {
            try {
                const firebaseConfig = {
                  apiKey: "AIzaSyDwCD9JK4dahhbNW9ChLKDR6EmWecJbZuA",
                  authDomain: "quiz-t2q.firebaseapp.com",
                  projectId: "quiz-t2q",
                  storageBucket: "quiz-t2q.appspot.com",
                  messagingSenderId: "1035883523561",
                  appId: "1:1035883523561:web:819c8e84be99bfc1ff2f78",
                  measurementId: "G-J6JCMZN14J"
                };
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, async (user) => { user ? userId = user.uid : await signInAnonymously(auth); });
            } catch (error) { console.error("Firebaseの初期化に失敗しました:", error); showMessage("Firebase初期化エラー", 5000); }
        }

        // --- 画面制御 ---
        function showScreen(screenName) { Object.values(screens).forEach(s => s.classList.add('hidden')); screens[screenName]?.classList.remove('hidden'); }
        function showLoading(show) { loadingIndicator.classList.toggle('hidden', !show); }
        function showMessage(message, duration = 3000, type = 'error') {
            messageBox.classList.remove('bg-red-500', 'bg-orange-500');
            if (type === 'success') {
                messageBox.classList.add('bg-orange-500');
            } else {
                messageBox.classList.add('bg-red-500');
            }
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), duration);
        }

        // --- イベントリスナー設定 ---
        function setupEventListeners() {
            createNewQuizBtn.addEventListener('click', () => { resetEditScreen(); showScreen('edit'); });
            startQuizBtn.addEventListener('click', loadAndStartQuiz);
            editQuizBtn.addEventListener('click', loadQuizForEditing);
            saveQuizBtn.addEventListener('click', saveQuiz);
            backToHomeBtn.addEventListener('click', () => showScreen('home'));
            quizBackToHomeBtn.addEventListener('click', () => { showScreen('home'); resetQuizState(); });
            jsonInput.addEventListener('input', handleJsonInputChange);
            optionABtn.addEventListener('click', () => checkAnswer('A'));
            optionBBtn.addEventListener('click', () => checkAnswer('B'));
            nextQuestionBtn.addEventListener('click', displayNextQuestion);
        }

        function resetEditScreen() {
            quizNameEdit.value = '';
            jsonInput.value = '';
            imageInputsContainer.innerHTML = '<p class="text-center text-gray-500">JSONを貼り付けると、ここに画像URLの入力欄が表示されます。</p>';
        }

        function handleJsonInputChange() {
            const jsonText = jsonInput.value.trim();
            if (!jsonText) { resetEditScreen(); return; }
            try {
                let data = JSON.parse(jsonText);
                if (Array.isArray(data)) { data = { questions: data }; }
                if (data && Array.isArray(data.questions)) { renderImageInputs(data.questions); } 
                else { imageInputsContainer.innerHTML = '<p class="text-center text-red-500">JSONに`questions`配列が含まれていません。</p>'; }
            } catch (e) { imageInputsContainer.innerHTML = '<p class="text-center text-yellow-600">正しいJSON形式で入力してください...</p>'; }
        }

        function renderImageInputs(questions) {
            imageInputsContainer.innerHTML = ''; 
            questions.forEach((question, index) => {
                const questionImageUrl = question.questionImageUrl || '';
                const imageUrlA = question.options?.A?.imageUrl || '';
                const imageUrlB = question.options?.B?.imageUrl || '';
                const textA = question.options?.A?.text || '';
                const textB = question.options?.B?.text || '';

                const inputBlock = document.createElement('div');
                inputBlock.className = 'space-y-4 p-4 border border-gray-200 rounded-lg';
                inputBlock.innerHTML = `
                    <h3 class="font-bold text-gray-800">問題 ${index + 1}</h3>
                    <div class="space-y-2">
                         <label for="image-url-q-${index}" class="block text-sm font-medium text-gray-700">問題文の画像URL（任意）</label>
                         <input type="url" id="image-url-q-${index}" data-index="${index}" data-option="Q" class="image-url-input w-full p-3 border border-gray-300 rounded-lg" placeholder="https://..." value="${questionImageUrl}">
                         <img id="preview-q-${index}" src="${questionImageUrl}" alt="問題文のプレビュー" class="mt-2 w-full h-auto object-contain bg-gray-100 rounded-lg aspect-video ${questionImageUrl ? '' : 'hidden'}">
                    </div>
                    <p class="text-sm text-gray-600 bg-gray-50 p-2 rounded-md">Q: ${question.question}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <p class="text-sm text-gray-800 font-semibold bg-gray-50 p-2 rounded-md">選択肢A: ${textA}</p>
                            <label for="image-url-a-${index}" class="block text-sm font-medium text-gray-700">画像URL（任意）</label>
                            <input type="url" id="image-url-a-${index}" data-index="${index}" data-option="A" class="image-url-input w-full p-3 border border-gray-300 rounded-lg" placeholder="https://..." value="${imageUrlA}">
                            <img id="preview-a-${index}" src="${imageUrlA}" alt="選択肢Aのプレビュー" class="mt-2 w-full h-auto object-contain bg-gray-100 rounded-lg aspect-[4/3] ${imageUrlA ? '' : 'hidden'}">
                        </div>
                        <div class="space-y-2">
                            <p class="text-sm text-gray-800 font-semibold bg-gray-50 p-2 rounded-md">選択肢B: ${textB}</p>
                            <label for="image-url-b-${index}" class="block text-sm font-medium text-gray-700">画像URL（任意）</label>
                            <input type="url" id="image-url-b-${index}" data-index="${index}" data-option="B" class="image-url-input w-full p-3 border border-gray-300 rounded-lg" placeholder="https://..." value="${imageUrlB}">
                            <img id="preview-b-${index}" src="${imageUrlB}" alt="選択肢Bのプレビュー" class="mt-2 w-full h-auto object-contain bg-gray-100 rounded-lg aspect-[4/3] ${imageUrlB ? '' : 'hidden'}">
                        </div>
                    </div>`;
                imageInputsContainer.appendChild(inputBlock);
            });
            document.querySelectorAll('.image-url-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = e.target.dataset.index;
                    const option = e.target.dataset.option;
                    const previewImg = document.getElementById(`preview-${option.toLowerCase()}-${index}`);
                    updatePreviewImage(e.target.value, previewImg);
                });
            });
        }
        
        function updatePreviewImage(url, imgElement) {
            if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
                imgElement.src = url;
                imgElement.classList.remove('hidden');
            } else {
                 imgElement.src = '';
                 imgElement.classList.add('hidden');
            }
        }

        async function saveQuiz() {
            if (!db) { showMessage("データベースに接続されていません。"); return; }
            const quizName = quizNameEdit.value.trim();
            const jsonText = jsonInput.value.trim();
            if (!quizName || !jsonText) { showMessage("クイズ名とJSONデータを入力してください。"); return; }
            let quizData;
            try {
                quizData = JSON.parse(jsonText);
                if (Array.isArray(quizData)) { quizData = { questions: quizData }; }
                if (!quizData.questions || !Array.isArray(quizData.questions)) { throw new Error("`questions`配列が必要です。"); }
            } catch (error) { showMessage("JSONの形式が正しくありません。"); console.error("JSON parse error:", error); return; }

            quizData.questions.forEach((question, index) => {
                question.questionImageUrl = document.getElementById(`image-url-q-${index}`).value.trim();
                const urlA = document.getElementById(`image-url-a-${index}`).value.trim();
                const urlB = document.getElementById(`image-url-b-${index}`).value.trim();
                if (!question.options.A) question.options.A = {};
                if (!question.options.B) question.options.B = {};
                question.options.A.imageUrl = urlA;
                question.options.B.imageUrl = urlB;
            });

            showLoading(true);
            try {
                const quizRef = doc(db, `artifacts/default-app-id/public/data/quizzes`, quizName);
                await setDoc(quizRef, quizData);
                showMessage("クイズが正常に保存されました！", 3000, 'success');
                setTimeout(() => showScreen('home'), 1000);
            } catch (error) {
                console.error("Firebaseへの保存に失敗しました:", error); showMessage("保存に失敗しました。");
            } finally { showLoading(false); }
        }

        async function loadQuizForEditing() {
            if (!db) { showMessage("データベースに接続されていません。"); return; }
            const quizName = quizNameInputHome.value.trim();
            if (!quizName) { showMessage("クイズ名を入力してください。"); return; }
            showLoading(true);
            try {
                const quizRef = doc(db, `artifacts/default-app-id/public/data/quizzes`, quizName);
                const docSnap = await getDoc(quizRef);
                if (docSnap.exists()) {
                    const quizData = docSnap.data();
                    resetEditScreen();
                    quizNameEdit.value = quizName;
                    jsonInput.value = JSON.stringify(quizData, null, 2);
                    showScreen('edit');
                    jsonInput.dispatchEvent(new Event('input', { bubbles: true }));
                } else { showMessage("指定されたクイズが見つかりませんでした。"); }
            } catch (error) { console.error("Firebaseからの読み込みに失敗しました:", error); showMessage("クイズの読み込みに失敗しました。");
            } finally { showLoading(false); }
        }
        
        async function loadAndStartQuiz() {
            if (!db) { showMessage("データベースに接続されていません。"); return; }
            const quizName = quizNameInputHome.value.trim();
            if (!quizName) { showMessage("クイズ名を入力してください。"); return; }
            showLoading(true);
            try {
                const quizRef = doc(db, `artifacts/default-app-id/public/data/quizzes`, quizName);
                const docSnap = await getDoc(quizRef);
                if (docSnap.exists()) {
                    currentQuizData = docSnap.data();
                    if (!currentQuizData.questions || !Array.isArray(currentQuizData.questions)) { showMessage("クイズデータの形式が正しくありません。"); return; }
                    resetQuizState();
                    quizTitle.textContent = quizNameInputHome.value;
                    displayQuestion(0);
                    showScreen('quiz');
                } else { showMessage("指定されたクイズが見つかりませんでした。"); }
            } catch (error) { console.error("Firebaseからの読み込みに失敗しました:", error); showMessage("クイズの読み込みに失敗しました。");
            } finally { showLoading(false); }
        }
        
        function resetQuizState() { currentQuestionIndex = 0; score = 0; feedbackContainer.classList.add('hidden'); nextQuestionBtn.classList.add('hidden'); optionABtn.disabled = false; optionBBtn.disabled = false; optionsContainer.classList.remove('hidden'); }
        
        function displayQuestion(index) {
            if (!currentQuizData || !currentQuizData.questions) return;
            const question = currentQuizData.questions[index];
            if (!question) return;

            if (question.questionImageUrl) { questionImg.src = question.questionImageUrl; questionImgContainer.classList.remove('hidden'); } 
            else { questionImgContainer.classList.add('hidden'); }
            
            questionText.textContent = question.question;
            quizProgress.textContent = `${index + 1} / ${currentQuizData.questions.length}`;
            
            optionAText.textContent = question.options.A.text;
            if (question.options.A.imageUrl) { optionAImg.src = question.options.A.imageUrl; optionAImg.classList.remove('hidden'); } 
            else { optionAImg.classList.add('hidden'); }

            optionBText.textContent = question.options.B.text;
            if (question.options.B.imageUrl) { optionBImg.src = question.options.B.imageUrl; optionBImg.classList.remove('hidden'); } 
            else { optionBImg.classList.add('hidden'); }

            feedbackContainer.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            optionABtn.disabled = false;
            optionBBtn.disabled = false;
            optionABtn.classList.remove('border-green-500', 'border-red-500', 'border-orange-500', 'border-blue-500');
            optionBBtn.classList.remove('border-green-500', 'border-red-500', 'border-orange-500', 'border-blue-500');
        }
        
        function checkAnswer(selectedOption) {
            optionABtn.disabled = true;
            optionBBtn.disabled = true;
            const question = currentQuizData.questions[currentQuestionIndex];
            const correctOption = question.answer;
            const selectedBtn = selectedOption === 'A' ? optionABtn : optionBBtn;
            const correctBtn = correctOption === 'A' ? optionABtn : optionBBtn;
            if (selectedOption === correctOption) {
                feedbackResult.textContent = "正解！";
                feedbackResult.className = "text-2xl font-bold text-center text-green-500";
                selectedBtn.classList.add('border-green-500');
                score++;
            } else {
                feedbackResult.textContent = "ざんねん…";
                feedbackResult.className = "text-2xl font-bold text-center text-orange-500";
                selectedBtn.classList.add('border-orange-500');
                correctBtn.classList.add('border-blue-500');
            }
            feedbackExplanation.textContent = question.explanation;
            feedbackContainer.classList.remove('hidden');
            nextQuestionBtn.classList.remove('hidden');
        }
        
        function displayNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizData.questions.length) { displayQuestion(currentQuestionIndex); } 
            else { showFinalScore(); }
        }
        
        function showFinalScore() {
            questionText.textContent = `クイズ終了！あなたのスコアは...`;
            optionsContainer.classList.add('hidden');
            questionImgContainer.classList.add('hidden');
            feedbackResult.textContent = `${currentQuizData.questions.length}問中 ${score}問正解！`;
            feedbackResult.className = "text-3xl font-bold text-center text-blue-600";
            feedbackExplanation.textContent = "お疲れ様でした。「終了する」ボタンでホームに戻ります。";
            feedbackContainer.classList.remove('hidden');
            nextQuestionBtn.classList.add('hidden');
        }

        // --- 初期化処理 ---
        window.onload = () => { initializeFirebase(); setupEventListeners(); showScreen('home'); };

    </script>
</body>
</html>

